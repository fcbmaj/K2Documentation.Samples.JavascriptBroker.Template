{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import \"@k2oss/k2-broker-core\";\r\nmetadata = {\r\n  \"systemName\": \"JsspITest_Multipart_File_Upload\",\r\n  \"displayName\": \"JavaScript Service Provider Multipart Form Data Execute File Upload Test\",\r\n  \"description\": \"This is for test purposes.\"\r\n};\r\nondescribe = function () {\r\n  console.log('test');\r\n  postSchema({\r\n    objects: {\r\n      \"JsspITest_Test1\": {\r\n        displayName: \"JsspITest_Test1\",\r\n        description: \"JsspITest_Test1.description\",\r\n        isActive: true,\r\n         properties: {\r\n           \"file1\": { displayName: \"File1\", description: \"Input File Prop\", type: \"attachment\" },\r\n           \"result\": { displayName: \"Result\", description: \"Result\", type: \"string\" }\r\n        },\r\n        methods: {\r\n         \"UploadFile\": {\r\n           displayName: \"Upload File\",\r\n           description: \"Upload File\",\r\n           type: \"read\",\r\n           inputs: [\"file1\"],\r\n           outputs: [\"result\"]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n};\r\nonexecute = function ({objectName, methodName, parameters, properties}) {\r\n  switch (objectName) {\r\n    case \"JsspITest_Test1\":\r\n      executeXHRTest(methodName, parameters, properties);\r\n      break;\r\n    default:\r\n      throw new Error(\"the object \" + objectName + \" is not supported.\");\r\n  }\r\n};\r\nfunction executeXHRTest(methodName, parameters, properties) {\r\n  switch (methodName) {\r\n    case \"UploadFile\":\r\n      executeUploadFileMethod(parameters, properties);\r\n      break;\r\n    default: throw new Error(\"The method \" + methodName + \" is not supported.\");\r\n  }\r\n}\r\nfunction executeUploadFileMethod(parameters, properties) {\r\n    \r\n  var oauthToken = \"77NUAGA2JjHNIm3Jo8D3rE3BDDBdl4wI\";\r\n\r\n  var form = new FormData();\r\n  form.append('attributes', JSON.stringify({\"name\": properties[\"file1\"].filename, \"parent\": {\"id\": \"0\"}})); //IMPORTANT\r\n  console.log(properties[\"file1\"].filename)\r\n  form.append('file', properties[\"file1\"].content);\r\n  console.log(properties[\"file1\"].content)\r\n      \r\n  var xhr = new XMLHttpRequest();\r\n  xhr.onreadystatechange = function () {\r\n    if (xhr.readyState !== 4) return;\r\n    if (xhr.status !== 201) throw new Error(\"Failed with status \" + JSON.stringify(xhr.response) +\". Details: \" + xhr.responseText);\r\n        \r\n    postResult({\"result\" :\"File uploaded successfully\" + JSON.stringify(xhr.response)}); \r\n    \r\n  };\r\n  xhr.open(\"POST\", 'https://upload.box.com/api/2.0/files/content');\r\n  xhr.setRequestHeader('Authorization', 'Bearer ' + oauthToken);\r\n  xhr.send(form);    \r\n}"],"names":["metadata","ondescribe","console","log","postSchema","objects","displayName","description","isActive","properties","type","methods","inputs","outputs","onexecute","objectName","methodName","parameters","oauthToken","form","FormData","append","JSON","stringify","filename","content","xhr","XMLHttpRequest","onreadystatechange","readyState","status","Error","response","responseText","postResult","open","setRequestHeader","send","executeUploadFileMethod","executeXHRTest"],"mappings":"AACAA,SAAW,YACK,8CACC,uFACA,8BAEjBC,WAAa,WACXC,QAAQC,IAAI,QACZC,WAAW,CACTC,QAAS,iBACY,CACjBC,YAAa,kBACbC,YAAa,8BACbC,UAAU,EACTC,WAAY,OACD,CAAEH,YAAa,QAASC,YAAa,kBAAmBG,KAAM,qBAC7D,CAAEJ,YAAa,SAAUC,YAAa,SAAUG,KAAM,WAEnEC,QAAS,YACM,CACZL,YAAa,cACbC,YAAa,cACbG,KAAM,OACNE,OAAQ,CAAC,SACTC,QAAS,CAAC,iBAOrBC,UAAY,UAAUC,WAACA,EAADC,WAAaA,EAAbC,WAAyBA,EAAzBR,WAAqCA,WACjDM,OACD,mBAOT,SAAwBC,EAAYC,EAAYR,UACtCO,OACD,cAMT,SAAiCC,EAAYR,OAEvCS,EAAa,mCAEbC,EAAO,IAAIC,SACfD,EAAKE,OAAO,aAAcC,KAAKC,UAAU,MAASd,EAAU,MAAUe,gBAAoB,IAAO,QACjGtB,QAAQC,IAAIM,EAAU,MAAUe,UAChCL,EAAKE,OAAO,OAAQZ,EAAU,MAAUgB,SACxCvB,QAAQC,IAAIM,EAAU,MAAUgB,aAE5BC,EAAM,IAAIC,eACdD,EAAIE,mBAAqB,cACA,IAAnBF,EAAIG,eACW,MAAfH,EAAII,OAAgB,MAAM,IAAIC,MAAM,sBAAwBT,KAAKC,UAAUG,EAAIM,UAAW,cAAgBN,EAAIO,cAElHC,WAAW,QAAW,6BAA+BZ,KAAKC,UAAUG,EAAIM,cAG1EN,EAAIS,KAAK,OAAQ,gDACjBT,EAAIU,iBAAiB,gBAAiB,UAAYlB,GAClDQ,EAAIW,KAAKlB,GAzBLmB,CAAwBrB,EAAYR,uBAEvB,IAAIsB,MAAM,cAAgBf,EAAa,uBAXpDuB,CAAevB,EAAYC,EAAYR,uBAGjC,IAAIsB,MAAM,cAAgBhB,EAAa"}