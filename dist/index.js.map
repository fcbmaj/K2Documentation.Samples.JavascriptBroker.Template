{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import \"@k2oss/k2-broker-core\";\r\nmetadata = {\r\n  \"systemName\": \"bazTestBroker\",\r\n  \"displayName\": \"Adobesign Broker\",\r\n  \"description\": \"Adobesign broker that accesses JSONPlaceholder.\",\r\n  \"configuration\": {\r\n      \"ServiceURL\": {\r\n          \"displayName\" : \"Adobesign URL\",\r\n          \"type\" : \"string\",\r\n          \"value\" : \"https://api.na2.adobesign.com/api/rest/v6\"\r\n      },\r\n      \"AccessToken\":{\r\n        \"displayName\" : \"Access Token\",\r\n        \"type\": \"string\",\r\n        \"value\" : \"3AAABLblqZhAsz7fkOci1ND7WDd20jYyUz2iHXweewyBfHX9jB46rtcAVKjL89-ty8o7dqbFLDVje0C5AF5vG_OC88kQNkjfL\"\r\n      }\r\n  }\r\n};\r\nondescribe = async function ({configuration}): Promise<void> {\r\n  postSchema({\r\n    objects: {\r\n      \"getid\": {\r\n        displayName: \"Get ID\",\r\n        description: \"Get Transaction ID\",\r\n        isActive: true,\r\n        properties: {\r\n          \"transDocId\": {\r\n            displayName: \"transient Document Id\",\r\n            type: \"string\"\r\n          },\r\n        },\r\n        methods: {\r\n          \"getDocs\": {\r\n            displayName: \"Get Docs\",\r\n            type: \"read\",\r\n            outputs: [\"transDocId\"],\r\n          },\r\n        },\r\n      },\r\n    },\r\n  });\r\n};\r\nonexecute = async function ({objectName, methodName, parameters, properties, configuration}): Promise<void> {\r\n  switch (objectName) {\r\n      case \"getid\": await executeXHRTest(methodName, parameters, properties, configuration); break;\r\n      default: throw new Error(\"The object \" + objectName + \" is not supported.\");\r\n  }\r\n}\r\nasync function executeXHRTest(methodName: string, parameters: SingleRecord, properties: SingleRecord, configuration: SingleRecord): Promise<void> {\r\n  switch (methodName) {\r\n      case \"getDocs\": await executeGetTransDocId(parameters, properties, configuration); break;\r\n      default: throw new Error(\"The method \" + methodName + \" is not supported.\");\r\n  }\r\n}\r\n// function executeGetTransDocId(parameters, properties, configuration) {\r\n//   var urlValue = configuration[\"ServiceURL\"];\r\n//   var urlToken = configuration[\"AccessToken\"];\r\n\r\n//   var form = new FormData();\r\n//   form.append(\"File\", \"sign this doc please\");\r\n//   form.append(\"File-Name\", \"please_sign.docx\");\r\n\r\n//   var xhr = new XMLHttpRequest();\r\n//   // xhr.withCredentials = true;\r\n  \r\n//   xhr.onreadystatechange = function () {\r\n\r\n//     if (xhr.readyState !== 4) {\r\n//       return;\r\n//     }\r\n//     if (xhr.readyState === 4) {\r\n//       console.log('readystate == 4 ' + xhr.responseText)\r\n//       var obj = JSON.parse(xhr.responseText);\r\n//       postResult({\r\n//         \"transDocId\" : obj.transientDocumentId\r\n//       });\r\n//     }\r\n//     if (xhr.status !== 200)\r\n//       throw new Error(\"Failed with status \" + xhr.status + \". Details: \" + xhr.responseText);\r\n//     };\r\n//   // xhr.onreadystatechange = function () {\r\n//   //   if(this.readyState === 4) {\r\n//   //     console.log(this.responseText);\r\n//   //     postResult({ \"transDocId\" :\"transientDocumentId\" + JSON.stringify(xhr.response)});\r\n//   //   }\r\n//   // };\r\n\r\n//   // xhr.open(\"POST\", urlValue + \"/transientDocuments\");\r\n//   // xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n//   // xhr.setRequestHeader(\"x-api-user\", \"email:nick.williams@ca.fctg.travel\");\r\n//   // xhr.setRequestHeader(\"Authorization\", \"Bearer \" + urlToken);\r\n\r\n//   xhr.open(\"POST\", \"https://api.na2.adobesign.com/api/rest/v6/transientDocuments\");\r\n//   // xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n//   xhr.setRequestHeader(\"x-api-user\", \"email:nick.williams@ca.fctg.travel\");\r\n//   xhr.setRequestHeader(\"Authorization\", \"Bearer 3AAABLblqZhAsz7fkOci1ND7WDd20jYyUz2iHXweewyBfHX9jB46rtcAVKjL89-ty8o7dqbFLDVje0C5AF5vG_OC88kQNkjfL\");\r\n\r\n//   xhr.send(form);\r\n// }\r\n\r\nfunction executeGetTransDocId(parameters: SingleRecord, properties: SingleRecord, configuration: SingleRecord): Promise<void> {\r\n    return new Promise<void>((resolve, reject) => {\r\n        // var urlValue = configuration[\"ServiceURL\"];\r\n        var form = new FormData();\r\n        form.append(\"File\", \"sign this doc please\");\r\n        form.append(\"File-Name\", \"please_sign.docx\");\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            try {\r\n                if (xhr.readyState !== 4) return;\r\n                if (xhr.status !== 200) throw new Error(\"Failed with status \" + xhr.status);\r\n\r\n                var obj = JSON.parse(xhr.responseText);\r\n                postResult({\r\n                    \"transDocId\": obj.transientDocumentId\r\n                  });\r\n                resolve();\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n\r\n        }\r\n\r\n        xhr.open(\"POST\", \"https://api.na2.adobesign.com/api/rest/v6/transientDocuments\");\r\n        xhr.setRequestHeader(\"x-api-user\", \"email:nick.williams@ca.fctg.travel\");\r\n        xhr.setRequestHeader(\"Authorization\", \"Bearer 3AAABLblqZhAsz7fkOci1ND7WDd20jYyUz2iHXweewyBfHX9jB46rtcAVKjL89-ty8o7dqbFLDVje0C5AF5vG_OC88kQNkjfL\");\r\n        xhr.send();\r\n    });\r\n}\r\n"],"names":["metadata","ondescribe","async","configuration","postSchema","objects","displayName","description","isActive","properties","type","methods","outputs","onexecute","objectName","methodName","parameters","Promise","resolve","reject","form","FormData","append","xhr","XMLHttpRequest","onreadystatechange","readyState","status","Error","obj","JSON","parse","responseText","postResult","transientDocumentId","error","open","setRequestHeader","send","executeXHRTest"],"mappings":"AACAA,SAAW,YACK,4BACC,+BACA,gEACE,YACC,aACM,qBACP,eACC,yDAEA,aACI,oBACR,eACE,uGAIlBC,WAAaC,gBAAgBC,cAACA,IAC5BC,WAAW,CACTC,QAAS,OACE,CACPC,YAAa,SACbC,YAAa,qBACbC,UAAU,EACVC,WAAY,YACI,CACZH,YAAa,wBACbI,KAAM,WAGVC,QAAS,SACI,CACTL,YAAa,WACbI,KAAM,OACNE,QAAS,CAAC,qBAOtBC,UAAYX,gBAAgBY,WAACA,EAADC,WAAaA,EAAbC,WAAyBA,EAAzBP,WAAqCA,EAArCN,cAAiDA,WACnEW,OACC,cAIXZ,eAA8Ba,EAAoBC,EAA0BP,EAA0BN,UAC5FY,OACC,gBAmDA,IAAIE,QAAc,CAACC,EAASC,SAE3BC,EAAO,IAAIC,SACfD,EAAKE,OAAO,OAAQ,wBACpBF,EAAKE,OAAO,YAAa,wBACrBC,EAAM,IAAIC,eACdD,EAAIE,mBAAqB,kBAEM,IAAnBF,EAAIG,WAAkB,UACP,MAAfH,EAAII,OAAgB,MAAM,IAAIC,MAAM,sBAAwBL,EAAII,YAEhEE,EAAMC,KAAKC,MAAMR,EAAIS,cACzBC,WAAW,YACOJ,EAAIK,sBAEtBhB,IACF,MAAOiB,GACLhB,EAAOgB,KAKfZ,EAAIa,KAAK,OAAQ,gEACjBb,EAAIc,iBAAiB,aAAc,sCACnCd,EAAIc,iBAAiB,gBAAiB,4GACtCd,EAAIe,6BA3ES,IAAIV,MAAM,cAAgBb,EAAa,uBAPlCwB,CAAexB,uBACpB,IAAIa,MAAM,cAAgBd,EAAa"}